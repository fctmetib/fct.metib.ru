<div class="auth__body">
  <div class="auth__body__form auth__body__form_reset">
    <div class="auth__body__form__title">
      <h1>Восстановление пароля</h1>
    </div>
    <metib-backend-error-messages *ngIf="backendErrors$ | async" [backendErrors]="backendErrors$ | async">
    </metib-backend-error-messages>
    <metib-success-messages *ngIf="(confirmationCode$ | async)"
      [message]="'На указанную почту отправлен код. Пожалуйста, введите его в поле КОД'"></metib-success-messages>

    <metib-success-messages *ngIf="(successMessage$ | async)" [message]="(successMessage$ | async)">
    </metib-success-messages>

    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="auth__body__form__fields">
        <div class="auth__body__form__fields__field">
          <input id="login" type="text" pInputText placeholder="Логин" formControlName="login"
            [ngClass]="{'ng-invalid ng-dirty': form.get('login').invalid && form.get('login').touched}">
          <!-- <small class="p-error" *ngIf="form.get('login').invalid && form.get('login').touched">
                <div *ngIf="form.get('login').errors['required']">
                  Поле Логин не должно быть пустым
                </div>
              </small> -->
        </div>

        <div class="auth__body__form__fields__field">
          <img id="image" [src]="image" height="50" width="200">
        </div>
        <p-button styleClass="p-button-link p-mb-4 registration-link" (click)="updateCaptcha()" label="Обновить картинку"></p-button>

        <!-- Captcha -->
        <div formGroupName="captcha">
          <div class="auth__body__form__fields__field">
            <input id="text" type="text" placeholder="Введите текст с картинки" pInputText formControlName="text"
              [ngClass]="{'ng-invalid ng-dirty': form.get('captcha.text').invalid && form.get('captcha.text').touched}">
            <small class="p-error" *ngIf="form.get('captcha.text').invalid && form.get('captcha.text').touched">
              <div *ngIf="form.get('captcha.text').errors['required']">
                Поле Текст с Картинки не должно быть пустым
              </div>
            </small>
          </div>
        </div>
      </div>

      <div class="actions actions_registration actions_additional" *ngIf="!(confirmationCode$ | async)">
        <p-button styleClass="p-button-link" [routerLink]="['/login']" label="Назад"></p-button>
        <button pButton type="submit" [disabled]="isSubmitting$ | async" class="main" label="Восстановить"></button>
      </div>

    </form>

    <form *ngIf="(confirmationCode$ | async)" [formGroup]="formConfirm" (ngSubmit)="onConfirmSubmit()">
      <div class="auth__body__form__fields">
        <div class="auth__body__form__fields__field">
          <input id="pin" type="text" pInputText placeholder="Код" formControlName="pin"
            [ngClass]="{'ng-invalid ng-dirty': formConfirm.get('pin').invalid && formConfirm.get('pin').touched}">
          <!-- <small class="p-error" *ngIf="formConfirm.get('pin').invalid && formConfirm.get('pin').touched">
            <div *ngIf="formConfirm.get('pin').errors['required']">
              Поле Код не должно быть пустым
            </div>
          </small> -->
        </div>
      </div>

      <div class="actions actions_registration actions_additional">
        <p-button styleClass="p-button-link" [routerLink]="['/login']" label="Назад"></p-button>
        <button pButton type="submit" [disabled]="isSubmitting$ | async" class="main"
          label="Подтвердить восстановление"></button>
      </div>
    </form>
  </div>
</div>
