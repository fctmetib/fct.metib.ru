<p-toast></p-toast>
<div [ngClass]="{'card-content': isUserVerified}">
  <div class="header lg">
    <div class="title">
      <h2>Запрос на нового дебитора</h2>
      <!-- <div class="subheader">
        Список заявок
      </div> -->
    </div>
    <div class="actions">
    </div>
  </div>

  <metib-success-messages *ngIf="alert" [message]="alertMessage"></metib-success-messages>
  <!-- <metib-backend-error-messages *ngIf="backendErrors$ | async" [backendErrors]="backendErrors$ | async">
  </metib-backend-error-messages> -->

  <form [formGroup]="formFree" (ngSubmit)="onSubmit()">
    <div class="form-actions">
      <button pButton pRipple type="button" label="Вернуться к списку запросов" class="p-button-outlined p-mr-2"
        [routerLink]="['/demand']"></button>
      <button pButton pRipple type="button" label="Создать Запрос" type="submit" class="basic"
        [disabled]="formFree.invalid || isLoading"></button>
    </div>
    <div class="p-fluid p-formgrid p-grid form">
      <!-- 1 row -->
      <div class="p-field p-col-12 p-md-12 p-lg-12">
        <label for="Id">Дебитор</label>
        <p-dropdown [options]="debtors" formControlName="Id" id="Id" [filter]="true" filterBy="Title"
          optionLabel="Title" optionValue="ID" editable="true"
          (change)="debtorChange()" (onChange)="debtorChange()"></p-dropdown>
          <small id="debtor-help">Выберите дебитора из списка или добавьте своего.</small>
        <div *ngIf="formFree.controls['Id'].invalid">
          <small *ngIf="formFree.controls['Id'].errors.required" class="p-error">
            Поле должно быть заполнено.
          </small>
        </div>
      </div>

      <div class="p-field p-col-12 p-md-12 p-lg-12" *ngIf="isNewDebtor">
        <label for="INN">ИНН</label>
        <input formControlName="INN" id="INN" type="text" pInputText aria-describedby="Инн">
        <div *ngIf="formFree.controls['INN'].invalid">
          <small *ngIf="formFree.controls['INN'].errors.required" class="p-error">
            Поле должно быть заполнено.
          </small>
        </div>
      </div>

      <!-- 2 row -->
      <div class="p-field p-col-12 p-md-6">
        <div class="addon-button mb-20">
          <div class="addon-text">
            <p>
              При необходимости прикрепите файлы:
            </p>
          </div>
          <div class="mib-uploader">
            <input type="file" id="All" (change)="onSelect($event, 'All')" multiple="true" hidden />
            <label for="All" class="mib-upload"><i class="pi pi-paperclip mr-20"></i> Выбрать файл</label>
          </div>
        </div>
        <div *ngIf="files.length">
          <ng-container *ngFor="let file of files">
            <div class="addon-button mb-10" *ngIf="file.Identifier === 'All'">
              <div class="addon-text">
                <p>
                  {{file.FileName}}
                </p>
              </div>
              <div class="mib-uploader">
                <div class="mib-upload-warn" (click)="removeFile(file)">
                  Удалить
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>

      <div class="p-field p-col-12 p-md-12">
        <label for="btn_submit">&nbsp;</label>
        <button id="btn_submit" pButton pRipple type="submit" label="Сохранить запрос"
          class="btn-mib-submit p-button-outlined" [disabled]="formFree.invalid || isLoading"></button>
      </div>
    </div>
  </form>
</div>
