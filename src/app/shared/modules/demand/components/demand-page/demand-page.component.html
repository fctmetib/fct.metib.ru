<div [ngClass]="{'card-content': isUserVerified}">
  <div class="header lg">
    <div class="title">
      <h2>Запросы</h2>
      <div class="subheader">
        Список Запросов
      </div>
    </div>
    <div class="actions">
      <button pButton pRipple type="button" label="История запросов" [routerLink]="['history']"></button>
    </div>
  </div>

  <div>
    <button pButton pRipple type="button" label="[TEST] Посмотреть мои сертификаты" (click)="openCerts()"></button>
  </div>

  <div class="p-grid">
    <ng-container *ngFor="let action of actions">
      <div *ngIf="isUserVerified" class="p-col">
        <div class="demand-action-card can-click" [routerLink]="[action.url]">
          <div class="demand-action-content">
            <div class="text">
              {{action.text}}
            </div>
            <div class="icon arrow_right"></div>
          </div>
        </div>
      </div>
      <div *ngIf="!isUserVerified && action.onlyNewClient" class="p-col">
        <div class="demand-action-card can-click" [routerLink]="[action.url]">
          <div class="demand-action-content">
            <div class="text">
              {{action.text}}
            </div>
            <div class="icon arrow_right"></div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</div>


<p-dialog header="Работа с ЭЦП" [(visible)]="displayModal" [modal]="true" [style]="{width: '80vw'}" [baseZIndex]="10000"
  [draggable]="false" [resizable]="false">
  <p-progressSpinner *ngIf="isCertsLoading; else templateContent"></p-progressSpinner>
  <ng-template #templateContent>
    <div style="min-height: '50vh'">
      <form #signatureForm="ngForm" novalidate (ngSubmit)="createSignature(thumbprint)">
        <fieldset>
          <legend>Создание подписи</legend>
          <label for="message">Подписываемое сообщение: *</label>
          <br>
          <textarea id="message" pInputTextarea name="message" cols="80" rows="5" placeholder="Введите сообщение" autofocus required
            [(ngModel)]="message">METIB</textarea>
          <br><br>

          <label for="certificate">Сертификат: *</label>
          <br>
          <p-dropdown id="certificate" name="certificate" [options]="certificateList"
           [(ngModel)]="thumbprint"
           optionLabel="name"
           optionValue="thumbprint"
           [showClear]="true"></p-dropdown>

          <pre>{{certificateListError}}</pre>

          <details *ngIf="thumbprint" (click)="showCertInfo(thumbprint)">
            <summary>Информация о сертификате</summary>
            <pre *ngIf="certInfo">{{certInfo | json}}</pre>
            <pre *ngIf="!certInfo">Запрашивается...</pre>
          </details>
          <pre>{{certificateInfoError}}</pre>

          <label>Тип подписи: *</label>
          <br>
          <label>
            <input type="radio" name="detachedSignature" [value]="false"
              [(ngModel)]="detachedSignature">Совмещенная</label>
          <br>
          <label>
            <input type="radio" name="detachedSignature" [value]="true"
              [(ngModel)]="detachedSignature">Отделенная</label>
          <br><br>

          <hr>
          <p-button type="submit" [disabled]="!signatureForm.valid" label="Создать подпись" style="margin-right: 1rem;"></p-button>
          <p-button type="button" [disabled]="!signatureForm.valid" label="Скачать подпись" (click)="download()"></p-button>
        </fieldset>
      </form>

      <fieldset>
        <legend>Результат</legend>
        <label for="hash">Хеш (ГОСТ Р 34.11-2012 256 бит):</label><br>
        <textarea id="hash" cols="80" rows="5" [(ngModel)]="hash" [placeholder]="hashStatus"></textarea>
        <pre>{{hashError}}</pre>

        <label for="signature">Подпись (PKCS7):</label><br>
        <textarea id="signature" name="signature" cols="80" rows="30" [placeholder]="signatureStatus"
          [(ngModel)]="signature"></textarea>
        <pre>{{signatureError}}</pre>

        <p>
          Для
          <a href="https://www.gosuslugi.ru/pgu/eds/" target="_blank" rel="nofollow noopener noreferrer"
            title="Перейти к проверке подписи">проверки</a>
          нужно создать файл со сгенерированной подписью в кодировке UTF-8 с расширением *.sgn
          <br>
          для отделенной подписи (или *.sig для совмещенной).
        </p>
      </fieldset>

      <fieldset>
        <legend>Информация о системе</legend>
        <pre *ngIf="systemInfo">{{systemInfo | json}}</pre>
        <pre>{{systemInfoError}}</pre>
      </fieldset>
    </div>
  </ng-template>
  <ng-template pTemplate="footer">
    <p-button icon="pi pi-check" (click)="displayModal=false" label="Ok" styleClass="p-button-text"></p-button>
  </ng-template>
</p-dialog>
