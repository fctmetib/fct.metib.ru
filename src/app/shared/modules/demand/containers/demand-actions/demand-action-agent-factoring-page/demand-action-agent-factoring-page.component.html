<p-toast></p-toast>
<div [ngClass]="{'card-content': isUserVerified}">
  <div class="header lg">
    <div class="title">
      <h2>Запрос на Агентский Факторинг</h2>
    </div>
    <div class="actions">
      <button pButton pRipple type="button" label="Вернуться к списку запросов" class="p-button-outlined p-mr-2"
        (click)="back()" *ngIf="isEdit"></button>
    </div>
  </div>

  <p-messages [(value)]="alertMessage" [enableService]="false"></p-messages>
  <!-- <metib-backend-error-messages *ngIf="backendErrors$ | async" [backendErrors]="backendErrors$ | async">
  </metib-backend-error-messages> -->

  <ng-container *ngIf="isEdit; else createTemplate;">
    <p-tabView class="mib-tabs">
      <p-tabPanel header="Информация">
        <app-demand-info [currentDemandInfo]="currentInformation" (sendMessage)="handleSendMessage($event)">
        </app-demand-info>
      </p-tabPanel>
      <p-tabPanel header="Данные">
        <ng-container *ngTemplateOutlet="form; context: {formFactoring: formFactoring}"></ng-container>
      </p-tabPanel>
      <p-tabPanel header="Файлы">
        <app-demand-files (removeFile)="handleRemoveFile($event)" [currentDemandFiles]="currentDemand.Files">
        </app-demand-files>
      </p-tabPanel>
      <p-tabPanel header="Результат" *ngIf="isView">
        <app-demand-result [result]="currentDemand.Result">
        </app-demand-result>
      </p-tabPanel>
    </p-tabView>
  </ng-container>
  <ng-template #createTemplate>
    <ng-container *ngTemplateOutlet="form; context: {formFactoring: formFactoring}"></ng-container>
  </ng-template>

  <ng-template #form let-formFactoring="formFactoring">

    <ng-container *ngIf="isLoading; else contentTemplate">
      Загрузка...
    </ng-container>
    <ng-template #contentTemplate>

      <form [formGroup]="formFactoring" (ngSubmit)="onSubmit()">
        <div class="form-actions" *ngIf="!isEdit">
          <button pButton pRipple type="button" label="Вернуться к списку запросов" class="p-button-outlined p-mr-2"
            (click)="back()"></button>
        </div>
        <div class="p-fluid p-formgrid p-grid form">
          <!-- 1 row -->
          <div class="p-field p-col-12 p-lg-3">
            <label for="organizationShortName">Сокращенное наименование</label>
            <input id="organizationShortName" type="text" pInputText placeholder="Сокращенное наименование"
              formControlName="organizationShortName">
            <div *ngIf="formFactoring.controls['organizationShortName'].invalid">
              <small *ngIf="formFactoring.controls['organizationShortName'].errors.required" class="p-error">
                Поле должно быть заполнено.
              </small>
            </div>
          </div>
          <div class="p-field p-col-12 p-lg-3">
            <label for="organizationINN">ИНН</label>
            <input id="organizationINN" pInputText type="text" placeholder="ИНН" formControlName="organizationINN"
              minlength="10" maxlength="12">
            <div *ngIf="formFactoring.controls['organizationINN'].invalid">
              <small *ngIf="formFactoring.controls['organizationINN'].errors.required" class="p-error">
                Поле должно быть заполнено.
              </small>
              <small *ngIf="formFactoring.controls['organizationINN'].errors.minlength" class="p-error">
                Введите корректный ИНН (10 или 12 цифр).
              </small>
            </div>
          </div>
          <div class="p-field p-col-12 p-lg-3">
            <label for="organizationType">Тип организации</label>
            <p-dropdown id="organizationType" [options]="organizationTypes" placeholder="Выберите Тип организации"
              (onChange)="onTypeChanged($event.value)" formControlName="organizationType" optionLabel="title"
              optionValue="value"></p-dropdown>
          </div>
          <div class="p-field p-col-12 p-lg-3" *ngIf="formFactoring.get('organizationType').value === 1">
            <label for="organizationLegalForm">Правовая форма</label>
            <p-dropdown id="organizationLegalForm" [options]="ruleTypes" placeholder="Выберите Правовую форму"
              formControlName="organizationLegalForm" optionLabel="title" optionValue="value"></p-dropdown>
            <div *ngIf="formFactoring.controls['organizationLegalForm'].invalid">
              <small *ngIf="formFactoring.controls['organizationLegalForm'].errors.required" class="p-error">
                Поле должно быть заполнено.
              </small>
            </div>
          </div>
        </div>
        <div class="p-fluid p-formgrid p-grid form">
          <!-- 2 row -->
          <div class="p-field p-col-12 p-lg-3">
            <label for="organizationPhone">Телефон</label>
            <p-inputMask id="organizationPhone" type="tel" placeholder="Телефон" formControlName="organizationPhone"
              mask="+7-999-999-99-99"></p-inputMask>
            <div *ngIf="formFactoring.controls['organizationPhone'].invalid">
              <small *ngIf="formFactoring.controls['organizationPhone'].errors.required" class="p-error">
                Поле должно быть заполнено.
              </small>
            </div>
          </div>
          <div class="p-field p-col-12 p-lg-3">
            <label for="organizationEmail">E-mail</label>
            <input id="organizationEmail" type="email" pInputText placeholder="E-mail"
              formControlName="organizationEmail">
            <div *ngIf="formFactoring.controls['organizationEmail'].invalid">
              <small *ngIf="formFactoring.controls['organizationEmail'].errors.required" class="p-error">
                Поле должно быть заполнено.
              </small>
              <small *ngIf="formFactoring.controls['organizationEmail'].errors.email" class="p-error">
                Введите корректную почту.
              </small>
            </div>
          </div>
          <div class="p-field p-col-12 p-lg-6">
            <label for="organizationWEB">Адрес сайта</label>
            <input id="organizationWEB" type="text" pInputText placeholder="Адрес сайта"
              formControlName="organizationWEB">
            <div *ngIf="formFactoring.controls['organizationWEB'].invalid">
              <small *ngIf="formFactoring.controls['organizationWEB'].errors.required" class="p-error">
                Поле должно быть заполнено.
              </small>
            </div>
          </div>

          <!-- 3 row -->
          <div class="p-field p-col-12 p-md-12">
            <h3>Банковские реквизиты основного счёта</h3>
          </div>

          <div class="p-field p-col-12 p-md-3">
            <label for="bankBik">Бик банка</label>
            <p-autoComplete id="bankBik" placeholder="Бик банка" formControlName="bankBik" [suggestions]="resultsBIK"
              (completeMethod)="search($event)" (onSelect)="onBankSelect($event)"></p-autoComplete>

            <div *ngIf="formFactoring.controls['bankBik'].invalid">
              <small *ngIf="formFactoring.controls['bankBik'].errors.required" class="p-error">
                Введите корректный БИК банка (9 цифр).
              </small>
              <!-- <small *ngIf="formFactoring.controls['bankBik'].errors.minlength" class="p-error">

            </small> -->
            </div>
          </div>
          <div class="p-field p-col-12 p-md-3">
            <label for="bankCorrespondentAccount">Кор счёт банка</label>
            <p-inputMask id="bankCorrespondentAccount" type="text" mask="99999999999999999999"
              placeholder="Кор счёт банка" formControlName="bankCorrespondentAccount"></p-inputMask>
            <div *ngIf="formFactoring.controls['bankCorrespondentAccount'].invalid">
              <small *ngIf="formFactoring.controls['bankCorrespondentAccount'].errors.required" class="p-error">
                Введите корректный кор счет (20 цифр)
              </small>
            </div>
          </div>
          <div class="p-field p-col-12 p-md-6">
            <label for="bankName">Название банка</label>
            <p-autoComplete id="bankName" placeholder="Название банка" formControlName="bankName"
              [suggestions]="resultsBankname" (completeMethod)="searchByBankName($event)"
              (onSelect)="onBankSelect($event)">
            </p-autoComplete>

            <div *ngIf="formFactoring.controls['bankName'].invalid">
              <small *ngIf="formFactoring.controls['bankName'].errors.required" class="p-error">
                Поле должно быть заполнено.
              </small>
            </div>
          </div>
          <div class="p-field p-col-12 p-md-3">
            <label for="bankAccountOpenDate">Дата открытия счёта</label>
            <input id="bankAccountOpenDate" type="date" pInputText placeholder="Дата открытия счёта"
              formControlName="bankAccountOpenDate">
            <div *ngIf="formFactoring.controls['bankAccountOpenDate'].invalid">
              <small *ngIf="formFactoring.controls['bankAccountOpenDate'].errors.required" class="p-error">
                Поле должно быть заполнено.
              </small>
            </div>
          </div>
          <div class="p-field p-col-12 p-md-3">
            <label for="bankOwnerAccount">Номер счёта</label>
            <p-inputMask id="bankOwnerAccount" type="text" mask="99999999999999999999" placeholder="Номер счёта"
              formControlName="bankOwnerAccount"></p-inputMask>
            <div *ngIf="formFactoring.controls['bankOwnerAccount'].invalid">
              <small *ngIf="formFactoring.controls['bankOwnerAccount'].errors.required" class="p-error">
                Введите корректный номер счета (20 цифр)
              </small>
            </div>
          </div>
          <div class="p-field p-col-12 p-md-6">
            <label for="bankComment">Комментарий</label>
            <input id="bankComment" type="text" pInputText placeholder="Основной" formControlName="bankComment">
            <div *ngIf="formFactoring.controls['bankComment'].invalid">
              <small *ngIf="formFactoring.controls['bankComment'].errors.required" class="p-error">
                Поле должно быть заполнено.
              </small>
            </div>
          </div>

          <div class="p-field p-col-12 p-md-12">
            <h3>Банковские реквизиты остальных счетов</h3>

            <div class="mib-formset" formArrayName="otherBanks"
              *ngFor="let item of formFactoring.get('otherBanks')['controls']; let i = index;">
              <div class="title">
                <div class="text">
                  Счёт в банке
                </div>
                <button class="button warn" (click)="remove(i, 'otherBanks')">
                  Удалить
                </button>
              </div>
              <div class="form">
                <div [formGroupName]="i">
                  <div class="p-fluid p-formgrid p-grid">
                    <div class="p-field p-col-12 p-lg-3">
                      <label for="otherBankAccountOpenDate">Дата открытия счёта</label>
                      <input id="otherBankAccountOpenDate" type="date" pInputText placeholder="Дата открытия счёта"
                        formControlName="otherBankAccountOpenDate">
                      <div
                        *ngIf="formFactoring.get('otherBanks')['controls'][i].get('otherBankAccountOpenDate').invalid">
                        <small
                          *ngIf="formFactoring.get('otherBanks')['controls'][i].get('otherBankAccountOpenDate').errors.required"
                          class="p-error">
                          Поле должно быть заполнено.
                        </small>
                      </div>
                    </div>
                    <div class="p-field p-col-12 p-lg-3">
                      <label for="otherBankAccountCloseDate">Дата закрытия счёта</label>
                      <input id="otherBankAccountCloseDate" type="date" pInputText placeholder="Дата закрытия счёта"
                        formControlName="otherBankAccountCloseDate">
                    </div>
                    <div class="p-field p-col-12 p-lg-6">
                      <label for="otherBankName">Название банка</label>
                      <p-autoComplete id="otherBankName" placeholder="Название банка" formControlName="otherBankName"
                        [suggestions]="resultsBankname" (completeMethod)="searchByBankName($event)"
                        (onSelect)="onOtherBankSelect(formFactoring.get('otherBanks')['controls'][i], $event)">
                      </p-autoComplete>
                      <div *ngIf="formFactoring.get('otherBanks')['controls'][i].get('otherBankName').invalid">
                        <small
                          *ngIf="formFactoring.get('otherBanks')['controls'][i].get('otherBankName').errors.required"
                          class="p-error">
                          Поле должно быть заполнено.
                        </small>
                      </div>
                    </div>
                    <div class="p-field p-col-12 p-lg-6">
                      <label for="otherBankOwnerAccount">Номер счёта</label>
                      <p-inputMask id="otherBankOwnerAccount" type="text" mask="99999999999999999999"
                        placeholder="Номер счёта" formControlName="otherBankOwnerAccount"></p-inputMask>
                      <div *ngIf="formFactoring.get('otherBanks')['controls'][i].get('otherBankOwnerAccount').invalid">
                        <small
                          *ngIf="formFactoring.get('otherBanks')['controls'][i].get('otherBankOwnerAccount').errors.required"
                          class="p-error">
                          Введите корректный номер счета (20 цифр)
                        </small>
                      </div>
                    </div>
                    <div class="p-field p-col-12 p-lg-6">
                      <label for="otherBankTarget">Цель использования</label>
                      <input id="otherBankTarget" type="text" pInputText placeholder="Цель использования"
                        formControlName="otherBankTarget">
                      <div *ngIf="formFactoring.get('otherBanks')['controls'][i].get('otherBankTarget').invalid">
                        <small
                          *ngIf="formFactoring.get('otherBanks')['controls'][i].get('otherBankTarget').errors.required"
                          class="p-error">
                          Поле должно быть заполнено.
                        </small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="p-field p-col-12 p-md-6">
            <div class="addon-button">
              <div class="addon-text-small">
                <p>
                  Дополнительные счета в других банках
                </p>
              </div>
              <button pButton pRipple (click)="addOtherBank()" label="Добавить счёт в банке" type="button"
                class="basic-small"></button>
            </div>
          </div>


          <div class="p-field p-col-12 p-md-12">
            <h3>Приложение к Анкете (Факторинг)</h3>
          </div>
          <div class="p-field p-col-12 p-lg-6">
            <label for="factoringProducts">Виды реализуемой продукции</label>
            <input id="factoringProducts" type="text" pInputText placeholder="Виды реализуемой продукции"
              formControlName="factoringProducts">
            <div *ngIf="formFactoring.controls['factoringProducts'].invalid">
              <small *ngIf="formFactoring.controls['factoringProducts'].errors.required" class="p-error">
                Поле должно быть заполнено.
              </small>
            </div>
          </div>
          <div class="p-field p-col-12 p-lg-6">
            <label for="factoringTradeMarks">Торговые марки, под которыми осуществляется продажа продукции</label>
            <input id="factoringTradeMarks" type="text" pInputText
              placeholder="Торговые марки, под которыми осуществляется продажа продукции"
              formControlName="factoringTradeMarks">
            <div *ngIf="formFactoring.controls['factoringTradeMarks'].invalid">
              <small *ngIf="formFactoring.controls['factoringTradeMarks'].errors.required" class="p-error">
                Поле должно быть заполнено.
              </small>
            </div>
          </div>
          <div class="p-field p-col-12 p-lg-6">
            <label for="factoringShipments">Основные поставщики</label>
            <input id="factoringShipments" type="text" pInputText placeholder="Основные поставщики"
              formControlName="factoringShipments">
            <div *ngIf="formFactoring.controls['factoringShipments'].invalid">
              <small *ngIf="formFactoring.controls['factoringShipments'].errors.required" class="p-error">
                Поле должно быть заполнено.
              </small>

            </div>
          </div>
          <div class="p-field p-col-12 p-lg-6">
            <label for="factoringFinanceLimit">Предполагаемый лимит финансирования</label>
            <p-inputNumber placeholder="Предполагаемый лимит финансирования" id="factoringFinanceLimit"
              formControlName="factoringFinanceLimit" inputId="factoringFinanceLimit" mode="currency" currency="RUB"
              locale="ru-RU">
            </p-inputNumber>
            <div *ngIf="formFactoring.controls['factoringFinanceLimit'].invalid">
              <small *ngIf="formFactoring.controls['factoringFinanceLimit'].errors.required" class="p-error">
                Поле должно быть заполнено.
              </small>
            </div>
          </div>
          <div class="p-field p-col-12 p-lg-6">
            <label for="factoringClients">Основные покупатели</label>
            <input id="factoringClients" type="text" pInputText placeholder="Основные покупатели"
              formControlName="factoringClients">
            <div *ngIf="formFactoring.controls['factoringClients'].invalid">
              <small *ngIf="formFactoring.controls['factoringClients'].errors.required" class="p-error">
                Поле должно быть заполнено.
              </small>
            </div>
          </div>
          <div class="p-field p-col-12 p-lg-6">
            <label for="factoringWorkers">Количество сотрудников</label>
            <input id="factoringWorkers" type="number" pInputText placeholder="Количество сотрудников"
              formControlName="factoringWorkers">
            <div *ngIf="formFactoring.controls['factoringWorkers'].invalid">
              <small *ngIf="formFactoring.controls['factoringWorkers'].errors.required" class="p-error">
                Поле должно быть заполнено.
              </small>
            </div>
          </div>

          <!-- W -->
          <div class="p-field p-col-12 p-md-12">
            <h3>Сведения о недвижимости, находящейся в собственности/аренде Предприятия</h3>
            <p class="description">По каждому пункту указать, на каких основаниях и на каких условиях Предприятие
              владеет
              тем или иным объектом недвижимости</p>

            <div class="mib-formset" formArrayName="factoringPlaces"
              *ngFor="let item of formFactoring.get('factoringPlaces')['controls']; let i = index;">
              <div class="title">
                <div class="text">
                  Собственность
                </div>
                <button class="button warn" (click)="remove(i, 'factoringPlaces')">
                  Удалить
                </button>
              </div>
              <div class="form">
                <div [formGroupName]="i">
                  <div class="p-fluid p-formgrid p-grid">
                    <div class="p-field p-col-12 p-md-6">
                      <label for="factoringPlacesAddress">Адрес объёкта</label>
                      <div class="addon-button">
                        <input id="factoringPlacesAddress" type="text" pInputText placeholder="Адрес объёкта" disabled
                          formControlName="displayAddress">
                        <button pButton pRipple type="button" label="Изменить" class="p-button-outlined mib-small"
                          (click)="openAddressForm(i)"></button>
                      </div>
                    </div>
                    <div class="p-field p-col-12 p-md-6">
                      <label for="factoringPlacesLegalForm">Форма владения</label>
                      <p-dropdown id="factoringPlacesLegalForm" [options]="typesOfOwner"
                        placeholder="Выберите Форму владения" formControlName="factoringPlacesLegalForm"
                        optionLabel="title" optionValue="value"></p-dropdown>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="p-field p-col-12 p-md-6">
            <div class="addon-button">
              <div class="addon-text-small">
                <p>
                  Дополнительная недвижимость
                </p>
              </div>
              <button pButton pRipple (click)="addOtherPlace()" label="Добавить недвижимость" type="button"
                class="basic-small"></button>
            </div>
          </div>


          <!-- W -->
          <div class="p-field p-col-12 p-md-12">
            <h3>Сведения о полученных ранее кредитах, аккредитивах, гарантиях, поручительствах</h3>
            <p class="description">Кредитная история и текущая кредиторская задолженность, в т. ч. ссуды из других
              источников, включая государственные учреждения</p>

            <div class="mib-formset" formArrayName="factoringCredits"
              *ngFor="let item of formFactoring.get('factoringCredits')['controls']; let i = index;">
              <div class="title">
                <div class="text">
                  Кредит, займ, гарантия, ...
                </div>
                <button class="button warn" (click)="remove(i, 'factoringCredits')">
                  Удалить
                </button>
              </div>
              <div class="form">
                <div [formGroupName]="i">
                  <div class="p-fluid p-formgrid p-grid">
                    <div class="p-field p-col-12 p-md-4 p-lg-3">
                      <label for="factoringCreditsCreditor">Кредитор</label>
                      <input id="factoringCreditsCreditor" type="text" pInputText placeholder="Кредитор"
                        formControlName="factoringCreditsCreditor">
                      <div
                        *ngIf="formFactoring.get('factoringCredits')['controls'][i].get('factoringCreditsCreditor').invalid">
                        <small
                          *ngIf="formFactoring.get('factoringCredits')['controls'][i].get('factoringCreditsCreditor').errors.required"
                          class="p-error">
                          Поле должно быть заполнено.
                        </small>
                      </div>
                    </div>
                    <div class="p-field p-col-12 p-md-4 p-lg-3">
                      <label for="factoringPlacesTypeDuty">Тип обязательства</label>
                      <input id="factoringPlacesTypeDuty" type="text" pInputText placeholder="Тип обязательства"
                        formControlName="factoringPlacesTypeDuty">
                      <div
                        *ngIf="formFactoring.get('factoringCredits')['controls'][i].get('factoringPlacesTypeDuty').invalid">
                        <small
                          *ngIf="formFactoring.get('factoringCredits')['controls'][i].get('factoringPlacesTypeDuty').errors.required"
                          class="p-error">
                          Поле должно быть заполнено.
                        </small>
                      </div>
                    </div>
                    <div class="p-field p-col-12 p-md-4 p-lg-3">
                      <label for="factoringPlacesDateClose">Дата погашения</label>
                      <input id="factoringPlacesDateClose" type="date" pInputText placeholder="Дата погашения"
                        formControlName="factoringPlacesDateClose">
                      <div
                        *ngIf="formFactoring.get('factoringCredits')['controls'][i].get('factoringPlacesDateClose').invalid">
                        <small
                          *ngIf="formFactoring.get('factoringCredits')['controls'][i].get('factoringPlacesDateClose').errors.required"
                          class="p-error">
                          Поле должно быть заполнено.
                        </small>
                      </div>
                    </div>
                    <div class="p-field p-col-12 p-md-4 p-lg-3">
                      <label for="factoringPlacesContractSum">Сумма договора</label>
                      <input id="factoringPlacesContractSum" type="text" pInputText placeholder="Сумма договора"
                        formControlName="factoringPlacesContractSum">
                      <div
                        *ngIf="formFactoring.get('factoringCredits')['controls'][i].get('factoringPlacesContractSum').invalid">
                        <small
                          *ngIf="formFactoring.get('factoringCredits')['controls'][i].get('factoringPlacesContractSum').errors.required"
                          class="p-error">
                          Поле должно быть заполнено.
                        </small>
                      </div>
                    </div>
                    <div class="p-field p-col-12 p-md-4 p-lg-3">
                      <label for="factoringPlacesBalanceReport">Остаток на дату сдачи отчетности</label>
                      <input id="factoringPlacesBalanceReport" type="text" pInputText
                        placeholder="Остаток на дату сдачи отчетности" formControlName="factoringPlacesBalanceReport">
                      <div
                        *ngIf="formFactoring.get('factoringCredits')['controls'][i].get('factoringPlacesBalanceReport').invalid">
                        <small
                          *ngIf="formFactoring.get('factoringCredits')['controls'][i].get('factoringPlacesBalanceReport').errors.required"
                          class="p-error">
                          Поле должно быть заполнено.
                        </small>
                      </div>
                    </div>
                    <div class="p-field p-col-12 p-md-4 p-lg-3">
                      <label for="factoringPlacesBalanceCurrent">Остаток на текущую дату</label>
                      <input id="factoringPlacesBalanceCurrent" type="text" pInputText
                        placeholder="Остаток на текущую дату" formControlName="factoringPlacesBalanceCurrent">
                      <div
                        *ngIf="formFactoring.get('factoringCredits')['controls'][i].get('factoringPlacesBalanceCurrent').invalid">
                        <small
                          *ngIf="formFactoring.get('factoringCredits')['controls'][i].get('factoringPlacesBalanceCurrent').errors.required"
                          class="p-error">
                          Поле должно быть заполнено.
                        </small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="p-field p-col-12 p-md-6">
            <div class="addon-button">
              <div class="addon-text-small">
                <p>
                  Дополнительная задолженность
                </p>
              </div>
              <button pButton pRipple (click)="addFactoringCredits()" label="Добавить задолженность" type="button"
                class="basic-small"></button>
            </div>
          </div>


          <!-- W -->
          <div class="p-field p-col-12 p-md-12">
            <h3>Приложение к Анкете (Финансирование коммерческой задолженности)</h3>
          </div>
          <div class="p-field p-col-12 p-md-6">
            <label for="factoringSuppliers">Поставщики</label>
            <input id="factoringSuppliers" type="text" pInputText placeholder="Поставщики"
              formControlName="factoringSuppliers">
            <div *ngIf="formFactoring.controls['factoringSuppliers'].invalid">
              <small *ngIf="formFactoring.controls['factoringSuppliers'].errors.required" class="p-error">
                Поле должно быть заполнено.
              </small>
            </div>
          </div>
          <div class="p-field p-col-12 p-md-6">
            <label for="factoringLimit">Предполагаемый лимит</label>
            <p-inputNumber placeholder="Предполагаемый лимит" id="factoringLimit"
              formControlName="factoringLimit" inputId="factoringLimit" mode="currency" currency="RUB" locale="ru-RU">
            </p-inputNumber>
            <div *ngIf="formFactoring.controls['factoringLimit'].invalid">
              <small *ngIf="formFactoring.controls['factoringLimit'].errors.required" class="p-error">
                Поле должно быть заполнено.
              </small>
            </div>
          </div>

          <!-- W -->
          <ng-container *ngIf="!isEdit">

            <div class="p-field p-col-12 p-md-12">
              <p>Прикрепите необходимые файлы:</p>
            </div>

            <div class="p-field p-col-12 p-md-6">
              <div class="addon-button mb-20">
                <div class="addon-text">
                  <p>
                    Устав (Со всеми изменениями)
                  </p>
                </div>
                <div class="mib-uploader">
                  <input type="file" id="Regulations" multiple="true" (change)="onSelect($event, 'Regulations')"
                    accept="image/jpeg,image/png,image/gif,application/pdf" hidden />
                  <label for="Regulations" class="mib-upload"><i class="pi pi-paperclip mr-20"></i> Выбрать файл</label>
                </div>
              </div>
              <div class="mib-uploader__error" *ngIf="isFileInvalid('Regulations')">
                <small class="p-error">
                  Необходимо загрузить документ
                </small>
              </div>


              <div *ngIf="files.length">
                <ng-container *ngFor="let file of files">
                  <div class="addon-button mb-10" *ngIf="file.Identifier === 'Regulations'">
                    <div class="addon-text">
                      <p>
                        {{file.FileName}}
                      </p>
                    </div>
                    <div class="mib-uploader">
                      <div class="mib-upload-warn" (click)="removeFile(file)">
                        Удалить
                      </div>
                    </div>
                  </div>
                </ng-container>
              </div>
            </div>
            <div class="p-field p-col-12 p-md-6">
              <div class="addon-button mb-20">
                <div class="addon-text">
                  <p>
                    Паспорт генерального директора
                    (Все страницы)
                  </p>
                </div>
                <div class="mib-uploader">
                  <input type="file" id="GenDirPassport" accept="image/jpeg,image/png,image/gif,application/pdf"
                    multiple="true" (change)="onSelect($event, 'GenDirPassport')" hidden />
                  <label for="GenDirPassport" class="mib-upload"><i class="pi pi-paperclip mr-20"></i> Выбрать
                    файл</label>
                </div>
              </div>
              <div class="mib-uploader__error" *ngIf="isFileInvalid('GenDirPassport')">
                <small class="p-error">
                  Необходимо загрузить документ
                </small>
              </div>


              <div *ngIf="files.length">
                <ng-container *ngFor="let file of files">
                  <div class="addon-button mb-10" *ngIf="file.Identifier === 'GenDirPassport'">
                    <div class="addon-text">
                      <p>
                        {{file.FileName}}
                      </p>
                    </div>
                    <div class="mib-uploader">
                      <div class="mib-upload-warn" (click)="removeFile(file)">
                        Удалить
                      </div>
                    </div>
                  </div>
                </ng-container>
              </div>
            </div>
            <div class="p-field p-col-12 p-md-6">
              <div class="addon-button mb-20">
                <div class="addon-text">
                  <p>
                    Протокол/решение о назначении генерального директора
                  </p>
                </div>
                <div class="mib-uploader">
                  <input type="file" id="GenDirProtocol" (change)="onSelect($event, 'GenDirProtocol')"
                    accept="image/jpeg,image/png,image/gif,application/pdf" hidden />
                  <label for="GenDirProtocol" class="mib-upload"><i class="pi pi-paperclip mr-20"></i> Выбрать
                    файл</label>
                </div>
              </div>
              <div class="mib-uploader__error" *ngIf="isFileInvalid('GenDirProtocol')">
                <small class="p-error">
                  Необходимо загрузить документ
                </small>
              </div>

              <div *ngIf="files.length">
                <ng-container *ngFor="let file of files">
                  <div class="addon-button mb-10" *ngIf="file.Identifier === 'GenDirProtocol'">
                    <div class="addon-text">
                      <p>
                        {{file.FileName}}
                      </p>
                    </div>
                    <div class="mib-uploader">
                      <div class="mib-upload-warn" (click)="removeFile(file)">
                        Удалить
                      </div>
                    </div>
                  </div>
                </ng-container>
              </div>
            </div>
            <div class="p-field p-col-12 p-md-6">
              <div class="addon-button mb-20">
                <div class="addon-text">
                  <p>
                    Приказ о назначении генерального директора
                  </p>
                </div>
                <div class="mib-uploader">
                  <input type="file" id="actual-btn" (change)="onSelect($event, 'GenDirOrder')"
                    accept="image/jpeg,image/png,image/gif,application/pdf" hidden />
                  <label for="actual-btn" class="mib-upload"><i class="pi pi-paperclip mr-20"></i> Выбрать файл</label>
                </div>
              </div>
              <div class="mib-uploader__error" *ngIf="isFileInvalid('GenDirOrder')">
                <small class="p-error">
                  Необходимо загрузить документ
                </small>
              </div>


              <div *ngIf="files.length">
                <ng-container *ngFor="let file of files">
                  <div class="addon-button mb-10" *ngIf="file.Identifier === 'GenDirOrder'">
                    <div class="addon-text">
                      <p>
                        {{file.FileName}}
                      </p>
                    </div>
                    <div class="mib-uploader">
                      <div class="mib-upload-warn" (click)="removeFile(file)">
                        Удалить
                      </div>
                    </div>
                  </div>
                </ng-container>
              </div>
            </div>
            <div class="p-field p-col-12 p-md-6">
              <div class="addon-button mb-20">
                <div class="addon-text">
                  <p>
                    Бухгалтерский Баланс
                  </p>
                </div>
                <div class="mib-uploader">
                  <input type="file" id="Balance" accept="image/jpeg,image/png,image/gif,application/pdf"
                    (change)="onSelect($event, 'Balance')" hidden />
                  <label for="Balance" class="mib-upload"><i class="pi pi-paperclip mr-20"></i> Выбрать файл</label>
                </div>
              </div>
              <div class="mib-uploader__error" *ngIf="isFileInvalid('Balance')">
                <small class="p-error">
                  Необходимо загрузить документ
                </small>
              </div>

              <div *ngIf="files.length">
                <ng-container *ngFor="let file of files">
                  <div class="addon-button mb-10" *ngIf="file.Identifier === 'Balance'">
                    <div class="addon-text">
                      <p>
                        {{file.FileName}}
                      </p>
                    </div>
                    <div class="mib-uploader">
                      <div class="mib-upload-warn" (click)="removeFile(file)">
                        Удалить
                      </div>
                    </div>
                  </div>
                </ng-container>
              </div>
            </div>
            <div class="p-field p-col-12 p-md-6">
              <div class="addon-button mb-20">
                <div class="addon-text">
                  <p>
                    ОСВ (оборотно-сальдовая ведомость)
                  </p>
                </div>
                <div class="mib-uploader">
                  <input type="file" id="OSV" accept="image/jpeg,image/png,image/gif,application/pdf"
                    (change)="onSelect($event, 'OSV')" hidden />
                  <label for="OSV" class="mib-upload"><i class="pi pi-paperclip mr-20"></i> Выбрать файл</label>
                </div>
              </div>
              <div class="mib-uploader__error" *ngIf="isFileInvalid('OSV')">
                <small class="p-error">
                  Необходимо загрузить документ
                </small>
              </div>


              <div *ngIf="files.length">
                <ng-container *ngFor="let file of files">
                  <div class="addon-button mb-10" *ngIf="file.Identifier === 'OSV'">
                    <div class="addon-text">
                      <p>
                        {{file.FileName}}
                      </p>
                    </div>
                    <div class="mib-uploader">
                      <div class="mib-upload-warn" (click)="removeFile(file)">
                        Удалить
                      </div>
                    </div>
                  </div>
                </ng-container>
              </div>
            </div>
            <div class="p-field p-col-12 p-md-6 p-lg-6">
              <div class="addon-button mb-20">
                <div class="addon-text">
                  <p>
                    Паспорта Учредителей
                  </p>
                </div>
                <div class="mib-uploader">
                  <input type="file" id="Shareholders" (change)="onSelect($event, 'Shareholders')"
                    accept="image/jpeg,image/png,image/gif,application/pdf" hidden />
                  <label for="Shareholders" class="mib-upload"><i class="pi pi-paperclip mr-20"></i> Выбрать
                    файл</label>
                </div>
              </div>
              <div class="mib-uploader__error" *ngIf="isFileInvalid('Shareholders')">
                <small class="p-error">
                  Необходимо загрузить документ
                </small>
              </div>

              <div *ngIf="files.length">
                <ng-container *ngFor="let file of files">
                  <div class="addon-button mb-10" *ngIf="file.Identifier === 'Shareholders'">
                    <div class="addon-text">
                      <p>
                        {{file.FileName}}
                      </p>
                    </div>
                    <div class="mib-uploader">
                      <div class="mib-upload-warn" (click)="removeFile(file)">
                        Удалить
                      </div>
                    </div>
                  </div>
                </ng-container>
              </div>
            </div>
            <div class="p-field p-col-12 p-md-6">
              <div class="addon-button mb-20">
                <div class="addon-text">
                  <p>
                    Договор поставки
                  </p>
                </div>
                <div class="mib-uploader">
                  <input type="file" id="ContractDelivery" multiple="true"
                    (change)="onSelect($event, 'ContractDelivery')"
                    accept="image/jpeg,image/png,image/gif,application/pdf" hidden />
                  <label for="ContractDelivery" class="mib-upload"><i class="pi pi-paperclip mr-20"></i> Выбрать
                    файлы</label>
                </div>
              </div>
              <div class="mib-uploader__error" *ngIf="isFileInvalid('ContractDelivery')">
                <small class="p-error">
                  Необходимо загрузить документ
                </small>
              </div>

              <div *ngIf="files.length">
                <ng-container *ngFor="let file of files">
                  <div class="addon-button mb-10" *ngIf="file.Identifier === 'ContractDelivery'">
                    <div class="addon-text">
                      <p>
                        {{file.FileName}}
                      </p>
                    </div>
                    <div class="mib-uploader">
                      <div class="mib-upload-warn" (click)="removeFile(file)">
                        Удалить
                      </div>
                    </div>
                  </div>
                </ng-container>
              </div>

            </div>
          </ng-container>
          <div class="p-field p-col-12 p-md-12">
            <label for="btn_submit">&nbsp;</label>
            <button id="btn_submit" pButton pRipple type="submit" label="Сохранить запрос"
              class="btn-mib-submit p-button-outlined"
              [disabled]="formFactoring.invalid || (isLoading$ | async) || isFilesInvalid()"></button>
          </div>
        </div>
      </form>

    </ng-template>

  </ng-template>
</div>
